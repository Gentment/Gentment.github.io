<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta name="baidu-site-verification" content="UqlC4pwKIm" />
  <meta name="baidu-site-verification" content="d3U0dGeqGw" />
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="google-site-verification" content="1C1XSuJ8TgM2O0mcZvsgzEdy0IdRZOJfxDYPyh18U9Q" />














  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  
    
      
    

    
  

  
    
      
    

    
  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.cat.net/css?family=Roboto Slab:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="LiuxiaoKun" type="application/atom+xml" />






<meta name="description" content="原文链接 Linux下编写C或者C++程序，有很多工具，但是主要编译器仍然是gcc和g++。最近用到STL中的List编程，为了检测写的代码是否会发现内存泄漏，了解了一下相关的知识。  所有使用动态内存分配(dynamic memory allocation)的程序都有机会遇上内存泄露(memory leakage)问题，在Linux里有三种常用工具来检测内存泄露的情況，包括：  参见 htt">
<meta property="og:type" content="article">
<meta property="og:title" content="Linux下的几款内存泄漏检测工具">
<meta property="og:url" content="https://LiuZiQiao.github.io/2018/12/24/Linux下的几款内存泄漏检测工具/index.html">
<meta property="og:site_name" content="LiuxiaoKun">
<meta property="og:description" content="原文链接 Linux下编写C或者C++程序，有很多工具，但是主要编译器仍然是gcc和g++。最近用到STL中的List编程，为了检测写的代码是否会发现内存泄漏，了解了一下相关的知识。  所有使用动态内存分配(dynamic memory allocation)的程序都有机会遇上内存泄露(memory leakage)问题，在Linux里有三种常用工具来检测内存泄露的情況，包括：  参见 htt">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://img-blog.csdn.net/20160719211251895">
<meta property="og:image" content="https://img-blog.csdn.net/20160719210756831">
<meta property="og:image" content="https://img-blog.csdn.net/20160719214131721">
<meta property="og:updated_time" content="2018-12-24T13:38:51.473Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Linux下的几款内存泄漏检测工具">
<meta name="twitter:description" content="原文链接 Linux下编写C或者C++程序，有很多工具，但是主要编译器仍然是gcc和g++。最近用到STL中的List编程，为了检测写的代码是否会发现内存泄漏，了解了一下相关的知识。  所有使用动态内存分配(dynamic memory allocation)的程序都有机会遇上内存泄露(memory leakage)问题，在Linux里有三种常用工具来检测内存泄露的情況，包括：  参见 htt">
<meta name="twitter:image" content="https://img-blog.csdn.net/20160719211251895">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: 'undefined',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://LiuZiQiao.github.io/2018/12/24/Linux下的几款内存泄漏检测工具/"/>






<script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
<link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet">

<style>
    .pace .pace-progress {
        background: #1E92FB; /*进度条颜色*/
        height: 3px;
    }
    .pace .pace-progress-inner {
         box-shadow: 0 0 10px #1E92FB, 0 0 5px     #1E92FB; /*阴影颜色*/
    }
    .pace .pace-activity {
        border-top-color: #1E92FB;    /*上边框颜色*/
        border-left-color: #1E92FB;    /*左边框颜色*/
    }
</style>
  <title>Linux下的几款内存泄漏检测工具 | LiuxiaoKun</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-111723881-1', 'auto');
  ga('send', 'pageview');
</script>





</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
	<a href="https://github.com/LiuZiQiao"><img style="position: absolute; top: 0; left: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_left_white_ffffff.png" alt="Fork me on GitHub"></a>
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">LiuxiaoKun</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">My Awesome Site</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://LiuZiQiao.github.io/2018/12/24/Linux下的几款内存泄漏检测工具/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="LiuXiaoKun">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LiuxiaoKun">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">Linux下的几款内存泄漏检测工具</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-24T21:31:00+08:00">
                2018-12-24
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2018-12-24T21:38:51+08:00">
                2018-12-24
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/12/24/Linux下的几款内存泄漏检测工具/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count gitment-comments-count" data-xid="/2018/12/24/Linux下的几款内存泄漏检测工具/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i> 浏览
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>次
            </span>
          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  3,373
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  13
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <script src="\assets\js\APlayer.min.js"> </script><a id="more"></a>
<p><a href="http://blog.csdn.net/gatieme%09https://blog.csdn.net/gatieme/article/details/51959654" target="_blank" rel="noopener">原文链接</a></p>
<p>Linux下编写C或者C++程序，有很多工具，但是主要编译器仍然是gcc和g++。最近用到STL中的List编程，为了检测写的代码是否会发现内存泄漏，了解了一下相关的知识。</p>

<p>所有使用动态内存分配(dynamic memory allocation)的程序都有机会遇上内存泄露(memory leakage)问题，在Linux里有三种常用工具来检测内存泄露的情況，包括：</p>

<p>参见 <a href="http://elinux.org/Memory_Debuggers" rel="nofollow" target="_blank">http://elinux.org/Memory_Debuggers</a> <br><br>偶然发现的<a href="http://blog.163.com/zhuang_qianxin/blog/static/29765138201051092529107/" rel="nofollow" target="_blank">内存泄露检测工具比较 </a></p>

<div class="table-box"><table><br><thead><br><tr><br>  <th align="center">工具</th><br>  <th align="center">描述</th><br></tr><br></thead><br><tbody><tr><br>  <td align="center"><a href="http://elinux.org/Memory_Debuggers#valgrind" rel="nofollow" target="_blank">valgrind</a></td><br>  <td align="center">一个强大开源的程序检测工具</td><br></tr><br><tr><br>  <td align="center"><a href="http://elinux.org/Memory_Debuggers#mtrace" rel="nofollow" target="_blank">mtrace</a></td><br>  <td align="center">GNU扩展, 用来跟踪malloc, mtrace为内存分配函数（malloc, realloc, memalign, free）安装hook函数</td><br></tr><br><tr><br>  <td align="center"><a href="" rel="nofollow" target="_blank">dmalloc</a></td><br>  <td align="center">用于检查C/C++内存泄露(leak)的工具，即检查是否存在直到程序运行结束还没有释放的内存,以一个运行库的方式发布</td><br></tr><br><tr><br>  <td align="center">memwatch</td><br>  <td align="center">和dmalloc一样，它能检测未释放的内存、同一段内存被释放多次、位址存取错误及不当使用未分配之内存区域</td><br></tr><br><tr><br>  <td align="center"><a href="http://mpatrol.sourceforge.net/" rel="nofollow" target="_blank">mpatrol</a></td><br>  <td align="center"><a href="http://www.ibm.com/developerworks/cn/linux/l-mleak2/" rel="nofollow" target="_blank">一个跨平台的 C++ 内存泄漏检测器</a></td><br></tr><br><tr><br>  <td align="center"><a href="http://dbgmem.sourceforge.net/" rel="nofollow" target="_blank">dbgmem</a></td><br>  <td align="center"></td><br></tr><br><tr><br>  <td align="center"><a href="http://elinux.org/Electric_Fence" rel="nofollow" target="_blank">Electric Fence</a></td><br>  <td align="center"></td><br></tr><br></tbody></table></div>


<h1 id="1-被测程序"><a name="t0"></a>1  被测程序</h1>

<hr>

<p class="cye-lm-tag">为了方便测试,,我们编写了一个简单的程序, 循环10次每次申请了一个100个字节的单元, 但是却不释放</p>



<h1 id="2-valgrind"><a name="t1"></a>2  valgrind</h1>

<hr>



<h2 id="21-valgrind介绍"><a name="t2"></a>2.1   valgrind介绍</h2>

<hr>

<p class="cye-lm-tag">是不是说没有一种内存检查工具能够在Linux使用呢，也不是，像开源的valgrind工具还是相当不错的</p>

<ul><br><li><p class="cye-lm-tag">Memcheck。这是valgrind应用最广泛的工具，一个重量级的内存检查器，能够发现开发中绝大多数内存错误使用情况，比如：使用未初始化的内存，使用已经释放了的内存，内存访问越界等。这也是本文将重点介绍的部分。</p></li><br><li><p class="cye-lm-tag">Callgrind。它主要用来检查程序中函数调用过程中出现的问题。</p></li><br><li><p class="cye-lm-tag">Cachegrind。它主要用来检查程序中缓存使用出现的问题。</p></li><br><li><p class="cye-lm-tag">Helgrind。它主要用来检查多线程程序中出现的竞争问题。</p></li><br><li><p class="cye-lm-tag">Massif。它主要用来检查程序中堆栈使用中出现的问题。</p></li><br><li><p class="cye-lm-tag">Extension。可以利用core提供的功能，自己编写特定的内存调试工具</p></li><br></ul>

<div class="table-box"><table><br><thead><br><tr><br>  <th align="center">主页</th><br>  <th align="center">下载</th><br></tr><br></thead><br><tbody><tr><br>  <td align="center"><a href="http://valgrind.org/" rel="nofollow" target="_blank">valgrind</a></td><br>  <td align="center"><a href="http://valgrind.org/downloads/current.html#current" rel="nofollow" target="_blank">downloads</a></td><br></tr><br></tbody></table></div>


<p class="cye-lm-tag"><img src="https://img-blog.csdn.net/20160719211251895" alt="valgrind介绍" title=""></p>

<blockquote><br>  <p class="cye-lm-tag">参照</p><br><br>  <p class="cye-lm-tag"><a href="http://www.cnblogs.com/sunyubo/archive/2010/05/05/2282170.html" rel="nofollow" target="_blank">Valgrind简单用法</a></p><br><br>  <p class="cye-lm-tag"><a href="http://blog.csdn.net/sduliulun/article/details/7732906" rel="nofollow" target="_blank">Unix下C程序内存泄漏检测工具Valgrind安装与使用</a></p><br><br>  <p class="cye-lm-tag"><a href="http://blog.csdn.net/sduliulun/article/details/7732906" rel="nofollow" target="_blank">valgrind 的使用简介</a></p><br><br>  <p class="cye-lm-tag"><a href="http://www.ibm.com/developerworks/cn/linux/l-cn-valgrind/" rel="nofollow" target="_blank">应用 Valgrind 发现 Linux 程序的内存问题</a></p><br><br>  <p class="cye-lm-tag"><a href="http://www.oschina.net/translate/valgrind-memcheck" rel="nofollow" target="_blank">如何使用Valgrind memcheck工具进行C/C++的内存泄漏检测</a></p><br></blockquote>



<h2 id="22-安装"><a name="t3"></a>2.2   安装</h2>

<hr>

<p class="cye-lm-tag"><strong>源码安装</strong></p>

<p class="cye-lm-tag">到<a href="http://valgrind.org/downloads/current.html#current" rel="nofollow" target="_blank">下载地址</a>)下载最新版的valgrind,按照里面的README提示，安装后就可以使用这个工具来检测内存泄露和内存越界等</p>



<pre class="prettyprint" name="code"><code class="language-c hljs  has-numbering">/configure

make

sudo make install

<p class="cye-lm-tag">当然也可以使用发行版的自带的源中安装</p>


sudo apt install valgrind

这是一个没有界面的内存检测工具，安装后，输入 valgrind ls -l 验证一下该工具是否工作正常（这是README里面的方法，实际上是验证一下对ls -l命令的内存检测），如果你看到一堆的信息说明你的工具可以使用了。



<h2 id="23-使用说明"><a name="t4"></a>2.3   使用说明</h2>

<hr>

<p class="cye-lm-tag">Valgrind工具包包含多个工具，如Memcheck,Cachegrind,Helgrind, Callgrind，Massif。</p>

<p class="cye-lm-tag"><strong>Memcheck</strong></p>

<p class="cye-lm-tag">最常用的工具，用来检测程序中出现的内存问题，所有对内存的读写都会被检测到，一切对malloc()/free()/new/delete的调用都会被捕获。所以，Memcheck 工具主要检查下面的程序错误</p>

<div class="table-box"><table>
<thead>
<tr>
  <th align="center">内容</th>
  <th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
  <td align="center">使用未初始化的内存</td>
  <td align="center">Use of uninitialised memory</td>
</tr>
<tr>
  <td align="center">使用已经释放了的内存</td>
  <td align="center">Reading/writing memory after it has been free’d</td>
</tr>
<tr>
  <td align="center">使用超过 malloc分配的内存空间</td>
  <td align="center">Reading/writing off the end of malloc’d blocks</td>
</tr>
<tr>
  <td align="center">对堆栈的非法访问</td>
  <td align="center">Reading/writing inappropriate areas on the stack</td>
</tr>
<tr>
  <td align="center">申请的空间是否有释放</td>
  <td align="center">Memory leaks – where pointers to malloc’d blocks are lost forever</td>
</tr>
<tr>
  <td align="center">malloc/free/new/delete申请和释放内存的匹配</td>
  <td align="center">Mismatched use of malloc/new/new [] vs free/delete/delete []</td>
</tr>
<tr>
  <td align="center">src和dst的重叠</td>
  <td align="center">Overlapping src and dst pointers in memcpy() and related functions</td>
</tr>
</tbody></table></div>


<p class="cye-lm-tag">这些问题往往是C/C++程序员最头疼的问题，Memcheck在这里帮上了大忙。 </p>

<p class="cye-lm-tag"><strong>Callgrind</strong></p>

<p class="cye-lm-tag">和gprof类似的分析工具，但它对程序的运行观察更是入微，能给我们提供更多的信息。和gprof不同，它不需要在编译源代码时附加特殊选项，但加上调试选项是推荐的。Callgrind收集程序运行时的一些数据，建立函数调用关系图，还可以有选择地进行cache模拟。在运行结束时，它会把分析数据写入一个文件。callgrind_annotate可以把这个文件的内容转化成可读的形式。 </p>

<p class="cye-lm-tag"><strong>Cachegrind</strong></p>

<p class="cye-lm-tag">Cache分析器，它模拟CPU中的一级缓存I1，Dl和二级缓存，能够精确地指出程序中cache的丢失和命中。如果需要，它还能够为我们提供cache丢失次数，内存引用次数，以及每行代码，每个函数，每个模块，整个程序产生的指令数。这对优化程序有很大的帮助。 </p>

<p class="cye-lm-tag"><strong>Helgrind</strong></p>

<p class="cye-lm-tag">它主要用来检查多线程程序中出现的竞争问题。Helgrind寻找内存中被多个线程访问，而又没有一贯加锁的区域，这些区域往往是线程之间失去同步的地方，而且会导致难以发掘的错误。Helgrind实现了名为“Eraser”的竞争检测算法，并做了进一步改进，减少了报告错误的次数。不过，Helgrind仍然处于实验阶段。 </p>

<p class="cye-lm-tag"><strong>Massif</strong></p>

<p class="cye-lm-tag">堆栈分析器，它能测量程序在堆栈中使用了多少内存，告诉我们堆块，堆管理块和栈的大小。Massif能帮助我们减少内存的使用，在带有虚拟内存的现代系统中，它还能够加速我们程序的运行，减少程序停留在交换区中的几率。 </p>

<blockquote>
  <p class="cye-lm-tag">此外，lackey和nulgrind也会提供。Lackey是小型工具，很少用到；Nulgrind只是为开发者展示如何创建一个工具</p>

  <p class="cye-lm-tag"><strong>注意</strong></p>

  <p class="cye-lm-tag">Valgrind不检查静态分配数组的使用情况</p>

  <p class="cye-lm-tag">Valgrind占用了更多的内存–可达两倍于你程序的正常使用量</p>

  <p class="cye-lm-tag">如果你用Valgrind来检测使用大量内存的程序就会遇到问题，它可能会用很长的时间来运行测试</p>
</blockquote>



<h2 id="24-使用说明"><a name="t5"></a>2.4   使用说明</h2>

<hr>

<p class="cye-lm-tag">编译程序</p>
g++ -g -o leak leak.c 

<p class="cye-lm-tag">被检测程序加入 –g   -fno-inline 编译选项保留调试信息, 否则后面的valgrind不能显示到出错行号。</p>

valgrind被设计成非侵入式的，它直接工作于可执行文件上，因此在检查前不需要重新编译、连接和修改你的程序。要检查一个程序很简单，只需要执行下面的命令就可以了。


valgrind --tool=tool_name program_name

比如我们要对ls -l命令做内存检查，只需要执行下面的命令就可以了



<pre class="prettyprint" name="code"><code class="language-c hljs  has-numbering">valgrind --tool=memcheck ls -l</code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre>

<blockquote><br>  <p class="cye-lm-tag">小提示 <br><br>  如果不知道有哪些参数, 可以先输入valgrind –tool=, 然后狂按两次tab, 会输出linux系统的只能提示, 同样,如果你输入了valgrind –tool=mem再狂按两次tab,linux系统会为你自动补全</p><br></blockquote>



<h2 id="25-使用valgrind检测memcheck"><a name="t6"></a>2.5   使用valgrind检测Memcheck</h2>

<hr>

<p class="cye-lm-tag">下面我们就可以用valgrind对我们的程序检测leak</p>



<pre class="prettyprint" name="code"><code class="language-c hljs  has-numbering">valgrind --tool=memcheck --leak-check=full --show-reachable=yes --trace-children=yes    ./leak</code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre>

<p class="cye-lm-tag">其中–leak-check=full 指的是完全检查内存泄漏，</p>

<p class="cye-lm-tag">–show-reachable=yes是显示内存泄漏的地点，</p>

<p class="cye-lm-tag">–trace-children=yes是跟入子进程。</p>

<p class="cye-lm-tag">当程序正常退出的时候valgrind自然会输出内存泄漏的信息原理：</p>

<p class="cye-lm-tag"><img src="https://img-blog.csdn.net/20160719210756831" alt="输出内存泄漏的信息原" title=""></p>



<h1 id="3-mtrace检测内存泄露"><a name="t7"></a>3  mtrace检测内存泄露</h1>

<hr>



<h2 id="31-mtrace简介"><a name="t8"></a>3.1   mtrace简介</h2>

<hr>

<p class="cye-lm-tag">在一般的linux发行版中，有一个自带的工具可以很方便的替你完成这些事，这个工具就是mtrace. </p>

<p class="cye-lm-tag">mtrace其实是GNU扩展函数，用来跟踪malloc。</p>

<p class="cye-lm-tag">mtrace为内存分配函数（malloc, realloc, memalign, free）安装hook函数。这些hook函数记录内存的申请和释放的trace信息。 <br><br>在程序中，这些trace信息可以被用来发现内存泄漏和释放不是申请的内存。 <br><br>当调用mtrace，mtrace会检查环境变量MALLOC_TRACE。该环境变量应该包含记录trace信息的文件路径。如果文件可以被成功打开，它的大小被截断为0。 <br><br>如果MALLOC_TRACE没有设置，或者设置的文件不可用或者不可写，那么将不会安装hook函数，mtrace不生效。</p>

<p class="cye-lm-tag">详细说明可参考man page：man 3 mtrace</p>



<h2 id="32-mtrace使用"><a name="t9"></a>3.2   mtrace使用</h2>

<hr>

<p class="cye-lm-tag">mtrace能监测程序是否内存泄露</p>

<ul><br><li>在程序的起始处包含头文件</li></ul>

<pre class="prettyprint" name="code"><code class="language-c hljs  has-numbering"><span class="hljs-preprocessor cye-lm-tag">#include &lt;mcheck.h&gt;</span></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre>

<ul><br><li>更改环境变量：export   MALLOC_TRACE=”mtrace.out”可以加入如下代码</li><br></ul>



<pre class="prettyprint" name="code"><code class="language-c hljs  has-numbering">setenv(<span class="hljs-string cye-lm-tag">"MALLOC_TRACE"</span>, <span class="hljs-string cye-lm-tag">"mtrace.out"</span>, <span class="hljs-number cye-lm-tag">1</span>);</code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre>

<ul><br><li>调用函数mtrace()</li><br></ul>



<pre class="prettyprint" name="code"><code class="language-c hljs  has-numbering">mtrace()</code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre>

<ul><br><li>编译程序带上 -g 选项</li><br></ul>



<pre class="prettyprint" name="code"><code class="language-c hljs  has-numbering">gcc -g -c leak_mtrace.c -o leak_mtrace.o  -<span class="hljs-built_in cye-lm-tag">std</span>=gnu9x -Wall</code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre>

<ul><br><li>运行程序一次，尽量调用所有程序内的函数。这时调试信息就已经被写入我们指定的mtrace.out文件中</li><br></ul>



<pre class="prettyprint" name="code"><code class="language-c hljs  has-numbering">./leak_mtrace </code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre>

<ul><br><li>mtrace a.out  mtrace.out查看内存监测情况</li><br></ul>



<pre class="prettyprint" name="code"><code class="language-c hljs  has-numbering">mtrace a.out  mtrace.out</code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li></ul></pre>

<p class="cye-lm-tag"><img src="https://img-blog.csdn.net/20160719214131721" alt="这里写图片描述" title=""></p>



<h1 id="4-dmalloc"><a name="t10"></a>4  dmalloc</h1>

<hr>

<p class="cye-lm-tag">dmalloc是一种用于检查C/C++内存泄露(leak)的工具，即检查是否存在直到程序运行结束还没有释放的内存，并且能够精确指出在哪个源文件的第几行。</p>



<h1 id="5-linux内核的kmemleak"><a name="t11"></a>5  Linux内核的Kmemleak</h1>



<h2 id="51-kmemleak检测工具介绍"><a name="t12"></a>5.1   Kmemleak检测工具介绍</h2>

<hr>

<p class="cye-lm-tag">Kmemleak工作于内核态是内核自带的内核泄露检测工具, 其源代码位于<a href="http://lxr.free-electrons.com/source/mm/kmemleak.c?v4.7" rel="nofollow" target="_blank">mm/kmemleak.c</a></p>

<p class="cye-lm-tag">Kmemleak工作于内核态，Kmemleak 提供了一种可选的内核泄漏检测，其方法类似于跟踪内存收集器。当独立的对象没有被释放时，其报告记录在 /sys/kernel/debug/kmemleak中，Kmemcheck能够帮助定位大多数内存错误的上下文。</p>



<h2 id="52-kmemleak使用过程概述"><a name="t13"></a>5.2   Kmemleak使用过程概述</h2>

<ul><br><li><p class="cye-lm-tag">首先`CONFIG_DEBUG_KMEMLEAK在Kernel hacking中被使能.</p></li><br><li><p class="cye-lm-tag">查看内核打印信息详细过程如下：</p><br><br><ol><li>挂载debugfs文件系统 <br><br>mount -t debugfs nodev /sys/kernel/debug/</li><br><li>开启内核自动检测线程 <br><br>echo scan &gt; /sys/kernel/debug/kmemleak</li><br><li>查看打印信息 <br><br>cat /sys/kernel/debug/kmemleak</li><br><li>清除内核检测报告，新的内存泄露报告将重新写入/sys/kernel/debug/kmemleak <br><br>echo clear &gt; /sys/kernel/debug/kmemleak</li></ol></li><br></ul>

<p class="cye-lm-tag">内存扫描参数可以进行修改通过向/sys/kernel/debug/kmemleak 文件写入。 参数使用如下</p>



<pre class="prettyprint" name="code"><code class="language-cpp hljs  has-numbering">off 禁用kmemleak（不可逆）
<span class="hljs-built_in cye-lm-tag">stack</span>=on 启用任务堆栈扫描(<span class="hljs-keyword cye-lm-tag">default</span>)
<span class="hljs-built_in cye-lm-tag">stack</span>=off 禁用任务堆栈扫描
scan=on 启动自动记忆扫描线程(<span class="hljs-keyword cye-lm-tag">default</span>)
scan=off 停止自动记忆扫描线程
scan=&lt;secs&gt; 设置n秒内自动记忆扫描
scan 开启内核扫描
clear 清除内存泄露报告
dump=&lt;addr&gt; 转存信息对象在&lt;addr&gt;</code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li></ul></pre>

<p class="cye-lm-tag">通过“kmemleak = OFF”，也可以在启动时禁用Kmemleak在内核命令行。在初始化kmemleak之前，内存的分配或释放这些动作被存储在一个前期日志缓冲区。这个缓冲区的大小通过配CONFIG_DEBUG_KMEMLEAK_EARLY_LOG_SIZE设置。 </p>



<h2 id="53-kmemleak动态检测原理"><a name="t14"></a>5.3   Kmemleak动态检测原理</h2>

<hr>

<p class="cye-lm-tag">通过的kmalloc、vmalloc、kmem_cache_alloc等内存分配会跟踪其指针，连同其他的分配大小和堆栈跟踪信息，存储在PRIO搜索树。相应的释放函数调用跟踪和指针就会从kmemleak数据结构中移除。 <br><br>分配的内存块，被认为是独立的，如果没有指针指向它起始地址或块的内部的任何位置，可以发现扫描内存（包括已保存的寄存器）。这意味着，有可能没有办法为内核通过所分配的地址传递块到一个释放函数，因此，该块被认为是一个内存泄漏。</p>

<p class="cye-lm-tag">扫描算法步骤： <br><br>1.  标记的所有分配对象为白色（稍后将剩余的白色物体考虑独立的）</p>

<ol><br><li><p class="cye-lm-tag">扫描存储器与所述数据片段和栈开始，检查对地址的值存储在PRIO搜索树。如果一个白色的对象的指针被发现，该对象将被添加到灰名单</p></li><br><li><p class="cye-lm-tag">扫描的灰色对象匹配的地址（一些白色物体可以变成灰色，并添加结束时的灰名单），直到黑色集结束</p></li><br><li><p class="cye-lm-tag">剩下的白色物体被认为是独立儿，并报告写入/sys/kernel/debug/kmemleak。 <br><br>一些分配的内存块的指针在内核的内部数据结构和它们不能被检测为孤儿。对避免这种情况，kmemleak也可以存储的数量的值，指向一个内的块的地址范围内的地址，需要找到使块不被认为是泄漏.</p></li><br></ol>



<h2 id="54-kmem相关函数"><a name="t15"></a>5.4   kmem相关函数</h2>

<hr>

<p class="cye-lm-tag">从kernel源代码中的目录<code>include /linux/kmemleak.h</code>中可查看函数原型的头</p>

<div class="table-box"><table><br><thead><br><tr><br>  <th align="center">函数</th><br>  <th align="center">功能</th><br></tr><br></thead><br><tbody><tr><br>  <td align="center">kmemleak_init</td><br>  <td align="center">初始化kmemleak</td><br></tr><br><tr><br>  <td align="center">kmemleak_alloc</td><br>  <td align="center">一个内存块分配的通知</td><br></tr><br><tr><br>  <td align="center">kmemleak_alloc_percpu</td><br>  <td align="center">通知的一个percpu的内存块分配</td><br></tr><br><tr><br>  <td align="center">kmemleak_free</td><br>  <td align="center">通知的内存块释放</td><br></tr><br><tr><br>  <td align="center">kmemleak_free_part</td><br>  <td align="center">通知释放部分内存块</td><br></tr><br><tr><br>  <td align="center">kmemleak_free_percpu</td><br>  <td align="center">一个percpu内存块释放的通知</td><br></tr><br><tr><br>  <td align="center">kmemleak_not_leak</td><br>  <td align="center">当不是泄露时，标记对象</td><br></tr><br><tr><br>  <td align="center">kmemleak_ignore</td><br>  <td align="center">当泄漏时不扫描或报告对象</td><br></tr><br><tr><br>  <td align="center">kmemleak_scan_area</td><br>  <td align="center">添加扫描区域内的内存块</td><br></tr><br><tr><br>  <td align="center">kmemleak_no_scan</td><br>  <td align="center">不扫描的内存块</td><br></tr><br><tr><br>  <td align="center">kmemleak_erase</td><br>  <td align="center">删除一个指针变量的旧值</td><br></tr><br><tr><br>  <td align="center">kmemleak_alloc_recursive</td><br>  <td align="center">为kmemleak_alloc，只检查递归</td><br></tr><br><tr><br>  <td align="center">kmemleak_free_recursive</td><br>  <td align="center">为kmemleak_free，只检查递归</td><br></tr><br></tbody></table></div>            <br>                        <link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-2b43bc2447.css" rel="stylesheet"><br>                </code></pre>
      
    </div>
    
    
    

    

    

    
      <div>
        

<div class="my_post_copyright">
  <script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>
 
  <!-- JS库 sweetalert 可修改路径 -->
  <script type="text/javascript" src="http://jslibs.wuxubj.cn/sweetalert_mini/jquery-1.7.1.min.js"></script>
  <script src="http://jslibs.wuxubj.cn/sweetalert_mini/sweetalert.min.js"></script>
  <link rel="stylesheet" type="text/css" href="http://jslibs.wuxubj.cn/sweetalert_mini/sweetalert.mini.css">
  <p><span>本文标题:</span><a href="/2018/12/24/Linux下的几款内存泄漏检测工具/">Linux下的几款内存泄漏检测工具</a></p>
  <p><span>文章作者:</span><a href="/" title="访问 LiuXiaoKun 的个人博客">LiuXiaoKun</a></p>
  <p><span>发布时间:</span>2018年12月24日 - 21:12</p>
  <p><span>最后更新:</span>2018年12月24日 - 21:12</p>
  <p><span>原始链接:</span><a href="/2018/12/24/Linux下的几款内存泄漏检测工具/" title="Linux下的几款内存泄漏检测工具">https://LiuZiQiao.github.io/2018/12/24/Linux下的几款内存泄漏检测工具/</a>
    <span class="copy-path"  title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="https://LiuZiQiao.github.io/2018/12/24/Linux下的几款内存泄漏检测工具/"  aria-label="复制成功！"></i></span>
  </p>
  <p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者。</p>  
</div>
<script> 
    var clipboard = new Clipboard('.fa-clipboard');
    clipboard.on('success', $(function(){
      $(".fa-clipboard").click(function(){
        swal({   
          title: "",   
          text: '复制成功',   
          html: false,
          timer: 500,   
          showConfirmButton: false
        });
      });
    }));  
</script>

      </div>
    

    <footer class="post-footer">
      

      
      
        <div class="post-widgets">
        

        

        
          
          <div id="needsharebutton-postbottom">
            <span class="btn">
              <i class="fa fa-share-alt" aria-hidden="true"></i>
            </span>
          </div>
        
        </div>
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/12/24/window双系统Deepin安装及正确删除/" rel="next" title="window双系统Deepin安装及正确删除">
                <i class="fa fa-chevron-left"></i> window双系统Deepin安装及正确删除
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/12/31/解决Linux下静态链接库出现的问题/" rel="prev" title="解决Linux下静态链接库出现的问题">
                解决Linux下静态链接库出现的问题 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


	
    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      
        <div id="gitment-container"></div>
      
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="LiuXiaoKun" />
            
              <p class="site-author-name" itemprop="name">LiuXiaoKun</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

			<!--my custom code begin-->
			<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
			<script src="https://cdnjs.cloudflare.com/ajax/libs/velocity/1.5.0/velocity.min.js"></script>
			<script type="text/javascript">
			  $("#sidebar").hover(function(){
				$("#mydivshow").velocity('stop').velocity({opacity: 1});
			  },function(){
				$("#mydivshow").velocity('stop').velocity({opacity: 0});
			  });
			</script>
			<div id="mydivshow" class="mydivshow">
			<!--my custom code end-->
			
          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">89</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">12</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">36</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          <div class="links-of-author motion-element">
            
              
                <span class="links-of-author-item">
                  <a href="https://github.com/LiuZiQiao" target="_blank" title="GitHub">
                    
                      <i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://gitee.com/LiuZiQiao" target="_blank" title="Gitee">
                    
                      <i class="fa fa-fw fa-glide"></i>Gitee</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:yourname @gmail.com" target="_blank" title="E-Mail">
                    
                      <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://plus.google.com/" target="_blank" title="Google">
                    
                      <i class="fa fa-fw fa-google"></i>Google</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://www.weibo.com/" target="_blank" title="微博">
                    
                      <i class="fa fa-fw fa-weibo"></i>微博</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://www.zhihu.com/people/yourname" target="_blank" title="知乎">
                    
                      <i class="fa fa-fw fa-bell"></i>知乎</a>
                </span>
              
            
          </div>

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                友情链接
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://me.csdn.net/qq_39478237" title="CSDN博客" target="_blank">CSDN博客</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://coolshell.cn/" title="COLSHELL" target="_blank">COLSHELL</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://sveter.github.io/" title="LYZ" target="_blank">LYZ</a>
                  </li>
                
              </ul>
            </div>
          

          <div id="player1" class="aplayer"></div>
<script src="/js/src/APlayer.min.js"></script>
<script type="text/javascript">
var ap = new APlayer({
    element: document.getElementById('player1'),                       // Optional, player element
    narrow: false,                                                     // Optional, narrow style
    autoplay: false,                                                    // Optional, autoplay song(s), not supported by mobile browsers
    showlrc: 0,                                                        // Optional, show lrc, can be 0, 1, 2, see: ###With lrc
    mutex: true,                                                       // Optional, pause other players when this player playing
    theme: '#e6d0b2',                                                  // Optional, theme color, default: #b7daff
    mode: 'random',                                                    // Optional, play mode, can be `random` `single` `circulation`(loop) `order`(no loop), default: `circulation`
    preload: 'metadata',                                               // Optional, the way to load music, can be 'none' 'metadata' 'auto', default: 'auto'
    listmaxheight: '513px',                                             // Optional, max height of play list
    music: {                                                           // Required, music info, see: ###With playlist
        title: '你曾是少年',                                          // Required, music title
        author: 'cover',                          // Required, music author
        url: 'http://mp3.qqmusic.cc/yq/102426570.mp3',  // Required, music url
        pic: '/images/visitor.jpg',  // Optional, music picture
    }
});
</script>
        </div>
		<!--my custom code begin-->
		</div>
		<!--my custom code end-->
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-被测程序"><span class="nav-number">1.</span> <span class="nav-text">1  被测程序</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-valgrind"><span class="nav-number">2.</span> <span class="nav-text">2  valgrind</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#21-valgrind介绍"><span class="nav-number">2.1.</span> <span class="nav-text">2.1   valgrind介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#22-安装"><span class="nav-number">2.2.</span> <span class="nav-text">2.2   安装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#23-使用说明"><span class="nav-number">2.3.</span> <span class="nav-text">2.3   使用说明</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#24-使用说明"><span class="nav-number">2.4.</span> <span class="nav-text">2.4   使用说明</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#25-使用valgrind检测memcheck"><span class="nav-number">2.5.</span> <span class="nav-text">2.5   使用valgrind检测Memcheck</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-mtrace检测内存泄露"><span class="nav-number">3.</span> <span class="nav-text">3  mtrace检测内存泄露</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#31-mtrace简介"><span class="nav-number">3.1.</span> <span class="nav-text">3.1   mtrace简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#32-mtrace使用"><span class="nav-number">3.2.</span> <span class="nav-text">3.2   mtrace使用</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-dmalloc"><span class="nav-number">4.</span> <span class="nav-text">4  dmalloc</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-linux内核的kmemleak"><span class="nav-number">5.</span> <span class="nav-text">5  Linux内核的Kmemleak</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#51-kmemleak检测工具介绍"><span class="nav-number">5.1.</span> <span class="nav-text">5.1   Kmemleak检测工具介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#52-kmemleak使用过程概述"><span class="nav-number">5.2.</span> <span class="nav-text">5.2   Kmemleak使用过程概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#53-kmemleak动态检测原理"><span class="nav-number">5.3.</span> <span class="nav-text">5.3   Kmemleak动态检测原理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#54-kmem相关函数"><span class="nav-number">5.4.</span> <span class="nav-text">5.4   kmem相关函数</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2018 &mdash; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">LiuXiaoKun</span>
	
	

	
  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">98.0k</span>
  
</div>






  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a></div>




        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i> 访问人数
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i> 访问总量
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>




  


  




	





  





  







<!-- LOCAL: You can save these files to your site and update links -->
    
        
        <link rel="stylesheet" href="https://aimingoo.github.io/gitmint/style/default.css">
        <script src="https://aimingoo.github.io/gitmint/dist/gitmint.browser.js"></script>
    
<!-- END LOCAL -->

    

    
      <script type="text/javascript">
      function renderGitment(){
        var gitment = new Gitmint({
            id: window.location.pathname, 
            owner: 'liuziqiao',
            repo: 'https://liuziqiao.github.io/',
            
            lang: "" || navigator.language || navigator.systemLanguage || navigator.userLanguage,
            
            oauth: {
            
            
                client_secret: '3e1215990096715396423947972d1e4c5e3b67a2',
            
                client_id: '5282da395b85f22364f8'
            }});
        gitment.render('gitment-container');
      }

      
      renderGitment();
      
      </script>
    







  





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  
  
  <link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css">

  
  
  <script src="/lib/needsharebutton/needsharebutton.js"></script>

  <script>
    
      pbOptions = {};
      
          pbOptions.iconStyle = "box";
      
          pbOptions.boxForm = "horizontal";
      
          pbOptions.position = "bottomCenter";
      
          pbOptions.networks = "Weibo,Wechat,Douban,QQZone,Twitter,Facebook";
      
      new needShareButton('#needsharebutton-postbottom', pbOptions);
    
    
  </script>

  

  
  


  
  <script type="text/javascript" src="/js/src/js.cookie.js?v=5.1.3"></script>
  <script type="text/javascript" src="/js/src/scroll-cookie.js?v=5.1.3"></script>


  
  <script type="text/javascript" src="/js/src/exturl.js?v=5.1.3"></script>


  <script src="/js/src/Aplayer-Controler.js"></script>
<div id="AP-controler"></div>
<script type="text/javascript">
var myapc=new APlayer_Controler({
		APC_dom:$('#AP-controler'),
		aplayer:ap, //此为绑定的aplayer对象
		attach_right:false,
		position:{top:'300px',bottom:''},
		fixed:true,
		btn_width:100,
		btn_height:120,
		img_src:['http://oty1v077k.bkt.clouddn.com/bukagirl.jpg',
				'http://oty1v077k.bkt.clouddn.com/jumpgirl.jpg',
				'http://oty1v077k.bkt.clouddn.com/pentigirl.jpg',
				'http://oty1v077k.bkt.clouddn.com/%E8%90%8C1.gif'],
		img_style:{repeat:'no-repeat',position:'center',size:'contain'},
		ctrls_color:'rgba(173,255,47,0.8)',
		ctrls_hover_color:'rgba(255,140,0,0.7)',
		tips_on:true,
		tips_width:140,
		tips_height:25,
		tips_color:'rgba(255,255,255,0.6)',
		tips_content:{},
		timeout:30
	});
</script>
  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>

<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/love.js"></script>



</body>
</html>
